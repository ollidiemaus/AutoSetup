<?xml version="1.0" encoding="UTF-8"?>
<Ui xmlns="http://www.blizzard.com/wow/ui/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.blizzard.com/wow/ui/
..\FrameXML\UI.xsd">

    <!-- AutoSetup Reload Popup Frame -->
    <Frame name="AutoSetupReloadPopup" parent="UIParent" inherits="DialogBoxFrame" movable="true" enableMouse="true" frameStrata="DIALOG">
        <Size>
            <AbsDimension x="400" y="160" />
        </Size>
        <Anchors>
            <Anchor point="CENTER" relativeTo="UIParent" relativePoint="CENTER">
                <Offset>
                    <AbsDimension x="0" y="-40" />
                </Offset>
            </Anchor>
        </Anchors>
        
        <!-- Background Texture -->
        <Layers>
            <Layer level="BACKGROUND">
                <Texture name="$parentBackground" file="Interface\DialogFrame\UI-DialogBox-Background">
                    <Size>
                        <AbsDimension x="384" y="128" />
                    </Size>
                    <Anchors>
                        <Anchor point="CENTER" />
                    </Anchors>
                </Texture>
            </Layer>
        </Layers>
        
        <!-- Title Text -->
        <Layers>
            <Layer level="OVERLAY">
                <FontString name="$parentTitle" inherits="GameFontNormal" text="AutoSetup - Reload Required">
                    <Anchors>
                        <Anchor point="TOP" relativeTo="$parent" relativePoint="TOP">
                            <Offset>
                                <AbsDimension x="0" y="-10" />
                            </Offset>
                        </Anchor>
                    </Anchors>
                </FontString>
                
                <!-- Message Text -->
                <FontString name="$parentMessage" inherits="GameFontHighlight" text="" justifyH="CENTER" justifyV="TOP">
                    <Anchors>
                        <Anchor point="TOP" relativeTo="$parentTitle" relativePoint="BOTTOM">
                            <Offset>
                                <AbsDimension x="0" y="-10" />
                            </Offset>
                        </Anchor>
                    </Anchors>
                    <Size>
                        <AbsDimension x="360" y="60" />
                    </Size>
                </FontString>
            </Layer>
        </Layers>
        
        <!-- Close Button (Top Right) -->
        <Frames>
            <Button name="$parentCloseButton" inherits="UIPanelCloseButton">
                <Size>
                    <AbsDimension x="32" y="32" />
                </Size>
                <Anchors>
                    <Anchor point="TOPRIGHT" relativeTo="$parent" relativePoint="TOPRIGHT">
                        <Offset>
                            <AbsDimension x="-6" y="-6" />
                        </Offset>
                    </Anchor>
                </Anchors>
            </Button>
            
            <!-- Reload Button -->
            <Button name="$parentReloadButton" inherits="GameMenuButtonTemplate" text="Reload UI">
                <Size>
                    <AbsDimension x="120" y="25" />
                </Size>
                <Anchors>
                    <Anchor point="BOTTOM" relativeTo="$parent" relativePoint="BOTTOM">
                        <Offset>
                            <AbsDimension x="0" y="20" />
                        </Offset>
                    </Anchor>
                </Anchors>
                <Scripts>
                    <OnClick>
                        -- Call the standard reload function directly.
                        if ReloadUI then
                            ReloadUI()
                        elseif C_UI and C_UI.Reload then
                            C_UI.Reload()
                        end
                    </OnClick>
                </Scripts>
            </Button>
            
            <!-- Later Button -->
            <Button name="$parentLaterButton" inherits="GameMenuButtonTemplate" text="Later">
                <Size>
                    <AbsDimension x="120" y="25" />
                </Size>
                <Anchors>
                    <Anchor point="RIGHT" relativeTo="$parentReloadButton" relativePoint="LEFT">
                        <Offset>
                            <AbsDimension x="-10" y="0" />
                        </Offset>
                    </Anchor>
                </Anchors>
                <Scripts>
                    <OnClick>
                        self:GetParent():Hide()
                    </OnClick>
                </Scripts>
            </Button>
        </Frames>
        
        <!-- Drag Handle -->
        <Scripts>
            <OnLoad>
                -- Set initial message text after a small delay to ensure child elements are ready
                C_Timer.After(0.1, function()
                    if self.Message then
                        self.Message:SetText("AddOn configuration has changed.\nA UI reload is required to apply changes.");
                    end

                    -- Hide any inherited dialog buttons that might show duplicate labels,
                    -- but keep our custom buttons visible.
                    local parentName = self:GetName() or ""
                    local keep = {
                        [parentName .. "ReloadButton"] = true,
                        [parentName .. "LaterButton"] = true,
                        [parentName .. "CloseButton"] = true,
                    }
                    local num = self:GetNumChildren() or 0
                    for i = 1, num do
                        local child = select(i, self:GetChildren())
                        if child and child.GetObjectType and child:GetObjectType() == "Button" then
                            local n = child:GetName() or ""
                            if not keep[n] then
                                child:Hide()
                            end
                        end
                    end
                end);
            </OnLoad>
            
            <OnShow>
                -- Bring to front when shown
                self:Raise();
            </OnShow>
        </Scripts>
    </Frame>

</Ui>
